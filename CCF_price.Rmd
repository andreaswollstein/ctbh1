---
title: "CCF cross correlation function"
output: html_notebook
---

CCF on price data
```{r}
rm(list=ls())
library(tidyverse)
library(dplyr)
library(tseries)

load("data/price_data.Rdata")
names(pd)
```

Do ccf on mutual shared time

```{r}
joined=inner_join(pd$BTC,pd$BAT,by="time")
cc = ccf(joined$close.x,joined$close.y,lag.max = 800)
idx = which(cc$acf==max(cc$acf))
abline(v=cc$lag[idx],col=2)
```

Do it pairwise

```{r}

nm = names(pd)

CC = matrix(0,nrow = length(nm),ncol=length(nm))
rownames(CC) = nm
colnames(CC) = nm

for (i in 1:(length(nm)-1)) {
  print(i)
  for (j in (i+1):length(nm)) {
    joined=inner_join(pd[[i]],pd[[j]],by="time")
    cc = ccf(joined$close.x,joined$close.y,lag.max = 24,pl=F)
    if (!is.na(max(cc$acf))) {
      idx = which(cc$acf==max(cc$acf))
      CC[i,j] = cc$lag[idx]
      CC[j,i] = cc$lag[idx]
    }
  }
}

```

```{r}
library(corrplot)
corrplot(CC/24, order="hclust",tl.cex = 0.3, addgrid.col = NULL)
```

